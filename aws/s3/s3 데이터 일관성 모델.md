# S3 데이터 일관성 모델 (Data Consistency Model)
## 데이터 일관성이란?
- 같은 시점에 조회한 데이터는 **항상 동일해야 한다**는 개념.
- 쉽게 말하면, 내가 데이터를 저장하고 나서 바로 읽으면 **내가 넣은 데이터가 나와야 정상**임.
---
## 비일관성 예시
1. S3에 파일 업로드 시작 (업로드 시간 약 0.1초)
2. 0.01초 후에 파일 조회 시도
→ 이 경우, 파일 업로드가 아직 완료되지 않았기 때문에 **빈 데이터**가 나올 수도 있음.
> 즉, 업로드는 했지만 읽으면 아무것도 안 나옴 → 이게 "일관성을 보장하지 않는다"는 의미
---
## S3의 일관성 정책 요약
| 동작 | 일관성 여부 | 설명 |
|--------------|------------------|------|
| **PUT 후 GET** | 일관성 보장 | 업로드 완료되면 바로 읽기 가능 |
| **DELETE 후 GET** | 최종 일관성 | 삭제 직후에도 파일이 남아있을 수 있음 |
| **UPDATE 후 GET** | 최종 일관성 | 수정 직후에도 예전 데이터가 나올 수 있음 |
---
## 최종 일관성 (Eventually Consistent)
- 삭제나 업데이트 직후에는 변경 사항이 **모든 노드에 전파되지 않았을 수 있음**
- 시간차를 두고 결국엔 바뀌긴 하지만, 바로는 **이전 상태가 보일 수 있음**
### 예시
- 객체 X를 업데이트한 직후:
- 어떤 사용자는 **Old 데이터**를 받을 수도 있음
- 어떤 사용자는 **New 데이터**를 받을 수도 있음
- 객체 X를 삭제한 직후:
- 어떤 사용자는 "객체 없음" 에러
- 어떤 사용자는 **삭제 전 데이터**를 받을 수도 있음
---
## 위치에 따라 결과가 다를 수 있음
- 서울에서 S3에 파일을 업데이트 했을 경우
- 서울 지역 사용자 → 거의 즉시 일관성 있음
- 부산 등 다른 지역 사용자 → 잠깐 동안은 구버전 볼 수 있음
→ 이걸 **원자성 부족**이라고도 함
---
## 용어 정리
- **일관성 (Consistency)**: 변경한 데이터가 즉시 반영되어 읽을 수 있는 특성
- **최종 일관성 (Eventually Consistent)**: 변경은 됐지만, 시간이 지나면서 반영되는 방식
- **원자성 (Atomicity)**: 트랜잭션이 전부 되거나, 전부 안되거나. 중간 없음
---
## 📌 정리 요약
- S3는 **쓰기 후 읽기(PUT → GET)**는 일관성 보장
- 하지만 **삭제(DELETE), 수정(UPDATE)**는 **최종 일관성**만 제공
- 따라서 S3를 DB처럼 실시간으로 쓰기엔 한계가 있음
- 보통 정적 웹 리소스(CSS, JS, 이미지 등)에 적합
